{"componentChunkName":"component---src-components-md-page-md-page-tsx","path":"/tools/swquote","result":{"pageContext":{"slug":"/tools/swquote","frontmatter":{"slug":"/tools/swquote","category":"tools","title":"SWQuote","description":"Search for any Star Wars quote line, and find the corresponding video snippet.","icon":"fab/galactic-republic","iconMonochromatic":null,"tags":"JavaScript, FFMPEG, Heroku","date":"2018-04-24","sonar":null,"github":{"issuesUrl":"https://github.com/lukasbach/swquote/issues"},"website":"https://swquote.herokuapp.com/","npm":null,"cli":null,"travis":null,"download":null,"actions":null,"attachements":null},"html":"<p>SWQuote is a small NodeJS Webapp, in which you can search for spoken phrases from star wars 3, and it will find the video snippet and show it. The algorithm uses the movies subtitles file to search. It is currently deployed on heroku, but with the source code it can deployed anywhere with any movie.</p>\n<p>See the demo in action here: <a href=\"https://swquote.herokuapp.com/\">https://swquote.herokuapp.com/</a></p>\n<h2>How it works</h2>\n<p>The application backend scans the subtitles file for the movie and creates an index in which it can search for quotes. The subtitle file maps small chunks of text to a start time and an end time, so when a quote search query is coming in, it looks through all those text chunks, matching the quote against the text. If it finds a matching text, it continues to match the rest of the quote against the following text chunks.</p>\n<p>After the start and end time of the quote in the movie is determined by doing that, ffmpeg is used to cut the corresponding part of the movie out. This cut is then being piped through an express.js app to serve the movie to the frontend via the url which is displayed below the video container.</p>\n<p>The application, both frontend and backend, are served via a heroku container. Because the container is using a free dyno with not much computing power, the app can take some time to find, cut and serve the video files, so expect waiting times of around 10 seconds per video lookup. I have also intensively reduced the video quality so that I am able to serve the movie with the free heroku dyno. The movie is scaled down to 240p with a video bitrate of 20kbit/s.</p>\n<p>To save processing power on the server and to make things easier, the video is only rendered into mp4 format, so if your browser does not load the video file, that might be why. If the quote could not be found, it also just does not load the video.</p>\n<h2>Deploying on custom server with custom movie</h2>\n<p>The server needs NodeJS, NPM and FFMPEG installed. Clone the repository on the server and move the movie file and subtitles file into the directory. Then modify the <em>index.js</em> file to customize its settings:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">var</span> pathToMovie <span class=\"token operator\">=</span> <span class=\"token string\">'./sw3.mp4'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> pathToSubtitles <span class=\"token operator\">=</span> <span class=\"token string\">'./ep3.srt'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Offset between movie and subtitles file. In the deployed version of the app, i have cut out the first 3 minutes in which nothing was spoken.</span>\n<span class=\"token keyword\">var</span> offsetH <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> offsetM <span class=\"token operator\">=</span> <span class=\"token number\">3</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> offsetS <span class=\"token operator\">=</span> <span class=\"token number\">4</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> ignoredCharacterRegex <span class=\"token operator\">=</span> <span class=\"token regex\">/[\\-\\!\\?\\.\\,\\:\\'\\\"\\`\\Â´ ]/g</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// Characters, which will be ignored in the subtitles file.</span>\n\n<span class=\"token keyword\">var</span> port <span class=\"token operator\">=</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">PORT</span> <span class=\"token operator\">||</span> <span class=\"token number\">5000</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">var</span> videoCodec <span class=\"token operator\">=</span> <span class=\"token string\">'libx264'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> audioCodec <span class=\"token operator\">=</span> <span class=\"token string\">'libfdk_aac'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Then, run <em>npm install</em> and <em>npm start</em> to start the server. It will serve video snippets which match the respective movie parts via the url <em>BASE<em>URL/v/search</em>query</em>, and it will serve the frontend directly via the base url.</p>"}}}